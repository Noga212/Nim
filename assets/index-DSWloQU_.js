(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();class l{constructor(e,s){this.count=e,this.id=s}removeItems(e){return e>0&&e<=this.count?(this.count-=e,!0):(console.error(`Invalid move: Trying to remove ${e} from a pile of ${this.count}`),!1)}isEmpty(){return this.count===0}reset(e){this.count=e}}class d{constructor(e=[3,4,5],s="user"){this.piles=e.map((i,t)=>new l(i,t)),this.currentPlayer=s,this.gameOver=!1,this.winner=null,this.initialConfig={pileCounts:e,startingPlayer:s}}userMove(e,s){if(this.currentPlayer!=="user"||this.gameOver)return!1;const i=this.piles[e].removeItems(s);return i&&(this.checkGameOver(),this.gameOver||(this.currentPlayer="computer")),i}calculateBestMove(){const e=this.piles.reduce((s,i)=>s^i.count,0);if(e===0)return{pileIndex:this.piles.find(i=>i.count>0).id,amount:1};for(let s=0;s<this.piles.length;s++){const i=this.piles[s].count^e;if(i<this.piles[s].count){const t=this.piles[s].count-i;return{pileIndex:s,amount:t}}}return null}makeAIMove(){if(this.currentPlayer!=="computer"||this.gameOver)return null;const e=this.calculateBestMove();return e&&(this.piles[e.pileIndex].removeItems(e.amount),this.checkGameOver(),this.gameOver||(this.currentPlayer="user")),e}checkGameOver(){this.piles.reduce((s,i)=>s+i.count,0)===0&&(this.gameOver=!0,this.winner=this.currentPlayer)}reset(e=this.initialConfig.pileCounts,s=this.initialConfig.startingPlayer){this.initialConfig={pileCounts:e,startingPlayer:s},this.piles=e.map((i,t)=>new l(i,t)),this.currentPlayer=s,this.gameOver=!1,this.winner=null}}class m{constructor(e){this.game=e,this.menuScreen=document.getElementById("menu-screen"),this.gameScreen=document.getElementById("game-screen"),this.boardElement=document.getElementById("board"),this.statusElement=document.getElementById("status"),this.actionButton=document.getElementById("end-turn"),this.overlay=document.getElementById("overlay"),this.winnerText=document.getElementById("winner-text"),this.selectedPileIndex=-1,this.selectedCount=0,this.initEventListeners()}initEventListeners(){document.getElementById("start-btn").addEventListener("click",()=>this.handleStartGame()),this.actionButton.addEventListener("click",()=>this.handlePick()),document.getElementById("restart-btn").addEventListener("click",()=>this.handleRestart()),document.getElementById("new-game-btn").addEventListener("click",()=>this.showMenu()),document.getElementById("play-again-btn").addEventListener("click",()=>{this.overlay.classList.remove("show"),this.handleRestart()})}showMenu(){this.gameScreen.classList.add("hidden"),this.menuScreen.classList.remove("hidden"),this.overlay.classList.remove("show")}showGame(){this.menuScreen.classList.add("hidden"),this.gameScreen.classList.remove("hidden"),this.render()}handleStartGame(){const e=document.getElementById("pile-config-input").value,s=document.querySelector('input[name="start-player"]:checked').value,i=e.split(",").map(t=>parseInt(t.trim())).filter(t=>!isNaN(t)&&t>0);if(i.length===0){alert("Please enter valid pile sizes (e.g. 3, 4, 5)");return}this.game.reset(i,s),this.resetSelection(),this.showGame(),s==="computer"&&this.handleAITurn()}handleRestart(){this.game.reset(),this.resetSelection(),this.render(),this.game.currentPlayer==="computer"&&this.handleAITurn()}resetSelection(){this.selectedPileIndex=-1,this.selectedCount=0,this.actionButton.disabled=!0}render(){this.boardElement.innerHTML="",this.game.piles.forEach((e,s)=>{const i=document.createElement("div");i.className=`pile ${this.selectedPileIndex===s?"active":""}`,i.addEventListener("click",t=>{if(this.game.currentPlayer!=="user"||this.game.gameOver)return;const n=i.getBoundingClientRect(),o=t.clientY-n.top,a=n.height,h=a/e.count;let c=Math.floor((a-o)/h);c<0&&(c=0),c>=e.count&&(c=e.count-1);const u=e.count-c;this.selectedPileIndex=s,this.selectedCount=u,this.actionButton.disabled=!1,this.render()});for(let t=0;t<e.count;t++){const n=document.createElement("div");n.className="item",this.selectedPileIndex===s&&t>=e.count-this.selectedCount&&n.classList.add("selected"),i.appendChild(n)}this.boardElement.appendChild(i)}),this.updateStatus()}async handlePick(){if(this.selectedCount>0){if(this.game.userMove(this.selectedPileIndex,this.selectedCount),this.resetSelection(),this.render(),this.game.gameOver){this.showGameOver();return}await this.handleAITurn()}}async handleAITurn(){this.statusElement.innerText="Computer is thinking...",await new Promise(e=>setTimeout(e,1e3)),this.game.makeAIMove(),this.game.gameOver?this.showGameOver():this.render()}updateStatus(){this.game.gameOver||(this.game.currentPlayer==="user"?(this.statusElement.style.color="var(--secondary)",this.statusElement.innerText="YOUR TURN"):(this.statusElement.style.color="var(--primary)",this.statusElement.innerText="COMPUTER'S TURN"))}showGameOver(){this.overlay.classList.add("show"),this.game.winner==="user"?(this.winnerText.innerText="VICTORY!",document.getElementById("winner-subtext").innerText="You defeated the Nim-sum!"):(this.winnerText.innerText="DEFEAT",this.winnerText.style.color="var(--danger)",document.getElementById("winner-subtext").innerText="The computer played perfectly.")}}document.addEventListener("DOMContentLoaded",()=>{const r=[3,4,5],e=new d(r);new m(e).showMenu()});
