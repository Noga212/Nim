(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class l{constructor(e,t){this.count=e,this.id=t}removeItems(e){return e>0&&e<=this.count?(this.count-=e,!0):(console.error(`Invalid move: Trying to remove ${e} from a pile of ${this.count}`),!1)}isEmpty(){return this.count===0}reset(e){this.count=e}}class d{constructor(e=[3,4,5],t="user"){this.piles=e.map((s,i)=>new l(s,i)),this.currentPlayer=t,this.gameOver=!1,this.winner=null,this.initialConfig={pileCounts:e,startingPlayer:t}}userMove(e,t){if(this.currentPlayer!=="user"||this.gameOver)return!1;const s=this.piles[e].removeItems(t);return s&&(this.checkGameOver(),this.gameOver||(this.currentPlayer="computer")),s}calculateBestMove(){const e=this.piles.reduce((t,s)=>t^s.count,0);if(e===0)return{pileIndex:this.piles.find(s=>s.count>0).id,amount:1};for(let t=0;t<this.piles.length;t++){const s=this.piles[t].count^e;if(s<this.piles[t].count){const i=this.piles[t].count-s;return{pileIndex:t,amount:i}}}return null}makeAIMove(){if(this.currentPlayer!=="computer"||this.gameOver)return null;const e=this.calculateBestMove();return e&&(this.piles[e.pileIndex].removeItems(e.amount),this.checkGameOver(),this.gameOver||(this.currentPlayer="user")),e}checkGameOver(){this.piles.reduce((t,s)=>t+s.count,0)===0&&(this.gameOver=!0,this.winner=this.currentPlayer)}reset(e=this.initialConfig.pileCounts,t=this.initialConfig.startingPlayer){this.initialConfig={pileCounts:e,startingPlayer:t},this.piles=e.map((s,i)=>new l(s,i)),this.currentPlayer=t,this.gameOver=!1,this.winner=null}}class m{constructor(e){this.game=e,this.menuScreen=document.getElementById("menu-screen"),this.gameScreen=document.getElementById("game-screen"),this.boardElement=document.getElementById("board"),this.statusElement=document.getElementById("status"),this.actionButton=document.getElementById("end-turn"),this.overlay=document.getElementById("overlay"),this.winnerText=document.getElementById("winner-text"),this.selectedPileIndex=-1,this.selectedCount=0,this.initEventListeners()}initEventListeners(){document.getElementById("start-btn").addEventListener("click",()=>this.handleStartGame()),this.actionButton.addEventListener("click",()=>this.handlePick()),document.getElementById("restart-btn").addEventListener("click",()=>this.handleRestart()),document.getElementById("new-game-btn").addEventListener("click",()=>this.showMenu()),document.getElementById("play-again-btn").addEventListener("click",()=>{this.overlay.classList.remove("show"),this.handleRestart()})}showMenu(){this.gameScreen.classList.add("hidden"),this.menuScreen.classList.remove("hidden"),this.overlay.classList.remove("show");const e=this.game.initialConfig.startingPlayer,t=document.querySelector(`input[name="start-player"][value="${e}"]`);t&&(t.checked=!0);const s=document.getElementById("pile-config-input");s&&(s.value=this.game.initialConfig.pileCounts.join(", "))}showGame(){this.menuScreen.classList.add("hidden"),this.gameScreen.classList.remove("hidden"),this.render()}handleStartGame(){const e=document.getElementById("pile-config-input").value,t=document.querySelector('input[name="start-player"]:checked').value,s=e.split(",").map(i=>parseInt(i.trim())).filter(i=>!isNaN(i)&&i>0);if(s.length===0){alert("Please enter valid pile sizes (e.g. 3, 4, 5)");return}this.game.reset(s,t),this.resetSelection(),this.showGame(),t==="computer"&&this.handleAITurn()}handleRestart(){this.game.reset(),this.resetSelection(),this.render(),this.game.currentPlayer==="computer"&&this.handleAITurn()}resetSelection(){this.selectedPileIndex=-1,this.selectedCount=0,this.actionButton.disabled=!0}render(){this.boardElement.innerHTML="",this.game.piles.forEach((e,t)=>{const s=document.createElement("div");s.className=`pile ${this.selectedPileIndex===t?"active":""}`,s.addEventListener("click",i=>{if(this.game.currentPlayer!=="user"||this.game.gameOver)return;const n=s.getBoundingClientRect(),o=i.clientY-n.top,c=n.height,u=c/e.count;let a=Math.floor((c-o)/u);a<0&&(a=0),a>=e.count&&(a=e.count-1);const h=e.count-a;this.selectedPileIndex=t,this.selectedCount=h,this.actionButton.disabled=!1,this.render()});for(let i=0;i<e.count;i++){const n=document.createElement("div");n.className="item",this.selectedPileIndex===t&&i>=e.count-this.selectedCount&&n.classList.add("selected"),s.appendChild(n)}this.boardElement.appendChild(s)}),this.updateStatus()}async handlePick(){if(this.selectedCount>0){if(this.game.userMove(this.selectedPileIndex,this.selectedCount),this.resetSelection(),this.render(),this.game.gameOver){this.showGameOver();return}await this.handleAITurn()}}async handleAITurn(){this.statusElement.innerText="Computer is thinking...",await new Promise(e=>setTimeout(e,1e3)),this.game.makeAIMove(),this.game.gameOver?this.showGameOver():this.render()}updateStatus(){this.game.gameOver||(this.game.currentPlayer==="user"?(this.statusElement.style.color="var(--secondary)",this.statusElement.innerText="YOUR TURN"):(this.statusElement.style.color="var(--primary)",this.statusElement.innerText="COMPUTER'S TURN"))}showGameOver(){this.overlay.classList.add("show"),this.game.winner==="user"?(this.winnerText.innerText="VICTORY!",document.getElementById("winner-subtext").innerText="You defeated the Nim-sum!"):(this.winnerText.innerText="DEFEAT",this.winnerText.style.color="var(--danger)",document.getElementById("winner-subtext").innerText="The computer played perfectly.")}}document.addEventListener("DOMContentLoaded",()=>{const r=[3,4,5],e=new d(r);new m(e).showMenu()});
